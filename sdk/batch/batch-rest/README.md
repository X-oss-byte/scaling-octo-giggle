# Azure BatchService REST client library for JavaScript

A Data-Plane client for issuing REST requests to the Azure Batch service. This is an autogenerated SDK from the TypeSpec specification files hosted within the **sdk/batch/batch-typespec** directory. Please view the **README** within that sub project for instructions on how to compile the TypeSpec files and generate the SDK.

**Please rely heavily on our [REST client docs](https://github.com/Azure/azure-sdk-for-js/blob/main/documentation/rest-clients.md) to use this library**

Key links:

- [Source code](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/batch/batch-rest)
- [Package (NPM)](https://www.npmjs.com/package/@azure-rest/batch)
- [API reference documentation](https://docs.microsoft.com/javascript/api/@azure-rest/batch?view=azure-node-preview)
- [Samples](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/batch/batch-rest/samples)

## Getting started

### Currently supported environments

- LTS versions of Node.js

### Prerequisites

- You must have an [Azure subscription](https://azure.microsoft.com/free/) which contains a [Batch account](https://learn.microsoft.com/en-us/azure/batch/batch-account-create-portal) to use this package. 

### Building and Testing
For a comprehensive description of how the project structure manages the Azure SDK libraries within the repo and how to setup your environment, please see the [Contributing Guide](https://github.com/Azure/azure-sdk-for-js/blob/main/CONTRIBUTING.md).

To build the Batch RLC SDK, run the following commands from the same directory as this README:
1. `rush update` to install and link all dependencies 
2. `rush build -t @azure-rest/batch` to build the codebase.

To run the unit-tests defined within the `test/` subdirectory, be sure to configure a service principal for authenticating your AAD application with Batch. For more detailed instructions on authenticating a service principal, you can look at [Authenticate Azure Batch services with Azure Active Directory](https://learn.microsoft.com/en-us/azure/batch/batch-aad-auth). Once you have configured your service principal and assigned RBAC access to it, you will need to define the following environment variables:

```
AZURE_BATCH_ACCOUNT
AZURE_BATCH_ACCESS_KEY
AZURE_BATCH_ENDPOINT
AZURE_CLIENT_SECRET
AZURE_CLIENT_ID
AZURE_TENANT_ID
TEST_MODE
```
Regarding the **TEST_MODE** environment variable, set it to `record` in order to generate recorded JSON files for each test where the test proxy records the HTTP requests and responses to and from the Batch Service. If you modify the network calls (either the number of calls or shape of the request), be sure to rerun the tests to regenerate the recordings. The recordings are also useful for viewing error responses that were not expected within the tests. Setting the **TEST_MODE** to `playback` will not make any outgoing HTTP requests to the Batch Service and will instead use the recorded responses from the JSON files themselves.

You can then run a test suite file by invoking the following command and passing the path to the local test file i.e.:
```
npm run unit-test:node test/public/pools.spec.ts
```


### Install the `@azure-rest/batch` package

Install the Azure BatchService REST client REST client library for JavaScript with `npm`:

```bash
npm install @azure-rest/batch
```

### Create and authenticate a `BatchGeneratedClient`

To use an [Azure Active Directory (AAD) token credential](https://github.com/Azure/azure-sdk-for-js/blob/main/sdk/identity/identity/samples/AzureIdentityExamples.md#authenticating-with-a-pre-fetched-access-token),
provide an instance of the desired credential type obtained from the
[@azure/identity](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/identity/identity#credentials) library.

To authenticate with AAD, you must first `npm` install [`@azure/identity`](https://www.npmjs.com/package/@azure/identity) 

After setup, you can choose which type of [credential](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/identity/identity#credentials) from `@azure/identity` to use.
As an example, [DefaultAzureCredential](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/identity/identity#defaultazurecredential)
can be used to authenticate the client.

Set the values of the client ID, tenant ID, and client secret of the AAD application as environment variables:
AZURE_CLIENT_ID, AZURE_TENANT_ID, AZURE_CLIENT_SECRET

## Troubleshooting

### Logging

Enabling logging may help uncover useful information about failures. In order to see a log of HTTP requests and responses, set the `AZURE_LOG_LEVEL` environment variable to `info`. Alternatively, logging can be enabled at runtime by calling `setLogLevel` in the `@azure/logger`:

```javascript
const { setLogLevel } = require("@azure/logger");

setLogLevel("info");
```

For more detailed instructions on how to enable logs, you can look at the [@azure/logger package docs](https://github.com/Azure/azure-sdk-for-js/tree/main/sdk/core/logger).
